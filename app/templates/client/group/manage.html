{% extends "./layout/client_base.html" %}

{% block title %} Manage Groups {% endblock title %}

{% block content %}

    <div class="row">

        <div class="col-md-12">
            <div class="group-box">

                <h3>MANAGE INTEREST GROUPS
                    <span class="pull-right">
                        <a href="/groups/create" style="text-decoration: none;">
                            <button class="btn btn-style-1 btn-sm" title="Create Perks">CREATE GROUP &nbsp;<i class="fa fa-plus"></i></button>
                        </a>
                        <a href="/groups" style="text-decoration: none;">
                            <button class="btn btn-style-4 btn-sm" title="Back To Perks">Cancel</button>
                        </a>
                    </span>
                </h3>
                <hr/>

                {% raw %}
                <div id="app" class="row">

                    <template v-if="groups.length > 0">
                    
                        <div v-for="group in groups" id="group_list">

                            <!-- GROUP CARD -->
                            <a :href="group.id" style="text-decoration: none;" title="Edit this group">
                                <div class="col-md-3 col-sm-6 group-card">
                                    <div class="zoomify group-panel grp-icon" :id="group.id">
                                        <div class="group-img">
                                            <img :src="group_covers_folder + group.cover_photo" style="height: 100%; width: 100%; min-width: 100%;">
                                            <img class="img-icon" :src="group_icons_folder + group.group_icon" style="z-index: 5; margin-top: -180px;" width="120px" height="120px">
                                        </div>
                                        <div class="group-desc">
                                            <h4 class="title">{{ group.name }}</h4>
                                            <p><i class="fa fa-user"></i> {{ group.population }}</p>
                                        </div>
                                    </div>
                                </div> <!-- END OF GROUP CARD -->
                            </a>
                    
                        </div> <!-- end of group-listing -->

                        <div class="show-more-box col-md-12">
                            <button v-show="hasNext" class="btn btn-style-3" v-on:click="loadGroups">Show More</button>
                        </div> <!-- end of show more div -->

                    </template>

                    <template v-else>
                        <div class="col-md-12 no-content-box text-center">
                            <h2><small>NO INTEREST GROUPS</small></h2>
                        </div>
                    </template>

                </div> <!-- end of app -->
                {% endraw %}
                
            </div>
        </div>

    </div>

{% endblock content %}

{% block scripts %}
<script>
        var vm = new Vue({
          el: '#app',
          data: {
            groups: [],
            groups_page: 1,
            hasNext: false,
            group_icons_folder: '/static/uploads/group_icons/',
            group_covers_folder: '/static/uploads/covers/',
            user_images_folder: '/static/uploads/profile_pictures/',
            activity_images_folder: '/static/uploads/activity_images/',
            default_img: "background-image: url('/static/images/pub-default-img.jpg');"
          },
          methods: {
            loadGroups: function() {
                $.ajax({
                    url: "{{ url_for('api.get_groups') }}" + "?page=" + this.groups_page,
                    type: 'GET'
                }).done(data => {
                    // console.log(data);
                    data.interest_groups.forEach((group) => {
                        group.members = [];
                        group.leaders = [];
                        group.membership_status = -1;
                        group.population = 0;
                        vm.groupPopulation(group);
                    });
                    this.groups.push.apply(this.groups, data.interest_groups);
                    this.groups_page++;
                    this.hasNext = data.has_next;
                });
            },
            groupPopulation: function(group) {

                // load group members
                $.ajax({
                    url: "/api/v1.0/interest_groups/" + group.id + "/members",
                    type: 'GET'
                }).done(data => {
                    group.population += data.length;
                });

                // load group leader
                $.ajax({
                    url: "/api/v1.0/interest_groups/" + group.id + "/leaders",
                    type: 'GET'
                }).done(data => {
                    group.population += data.length;
                    //console.log(group.name + " member count = " + group.population);
                });

            }
          }
        });

        $(document).ready(function() {
            vm.loadGroups();
        });

    </script> 
{% endblock scripts %}