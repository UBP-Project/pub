{% extends "./layout/client_base.html" %}

{% block title %} Perks {% endblock title %}

{% block content %}

	<div class="row">

		<div class="col-md-12">
			<div class="group-box">

				<h3>UNIONBANK PERKS
					{% if is_manager %}
					<span class="pull-right">
	                    <a href="/perks/create" style="text-decoration: none;">
                            <button class="btn btn-style-2 btn-sm" title="Create Perks">CREATE PERKS &nbsp;<i class="fa fa-plus"></i></button>
                        </a>
                    </span>
                    {% endif %}
                </h3>
                <hr/>

				{% raw %}
				<div id="perks_app" class="row">

					 <template v-if="perks.length > 0">
                        <div v-for="perk in perks" class="col-md-6" style="padding: 10px;">
                            <div class="row zoomify" style="border: 1px solid #d0d0d0; border-radius: 5px;">
                                <div class="col-md-5 no-padding" style="overflow: hidden;">
                                    <img :src="'../../static/uploads/perks_images/' + perk.image" style="object-fit: cover; min-height: 100%; max-height: 100%; height: 200px; width: 100%; min-width: 100%; max-width: 100%; overflow: hidden; border-radius: 3px 0 0 3px;" />
                                </div>
                                <div class="col-md-7" style="background-color: #fff; padding: 15px;">
                                    <h4 class="title" style="margin: 0;"><strong>{{ perk.title }}</strong></h4>
                                    <div style="height: 125px; overflow: hidden;">
                                        <p style="font-size: 15px; color: gray;"><small>{{ perk.description }}</small></p>
                                    </div>
                                    <h5 class="title" style="margin-bottom: 0px;"><small>{{ perk.timestamp }}</small></h5>
                                    <span style="position: absolute; top: 10px; right: 10px;">
	                                    <a v-show="is_manager" :href="'/perks/'+ perk.id + '/edit'" style="text-decoration: none;">
	                                        <button class="btn btn-style-3 btn-sm" :title="'Edit ' + perk.title"><i class="fa fa-gear"></i></button>
	                                    </a>
                                    </span>
                                </div>
                            </div>

                            <!-- GROUP MODAL -->
                            <div class="modal fade grp-modal" :id="'group-' + group.id" role="dialog">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <!-- HEADER -->
                                        <div class="modal-header">
                                            <span><b>INTEREST GROUP</b></span>
                                            <button type="button" class="close" data-dismiss="modal"><i class="fa fa-close"></i></button>
                                        </div>
                                        <!-- BODY -->
                                        <div class="modal-body">

                                            <div class="img-container text-center" :style="group.cover">
                                                <img :src="group_modal_covers_folder + group.cover_photo" style="min-height: 100%;">
                                                <img class="grp-icon-img" :src="group_modal_icons_folder + group.group_icon" style="position: absolute; top: 25px; margin-left: -100px;">
                                            </div>

                                            <span class="row">
                                                <span class="col-md-2 col-lg-2 col-sm-2 hidden-xs" style="border: none;"><h2 class="text-center"></h2></span>
                                                <span class="col-md-8 col-lg-8 col-sm-8"><h2 class="text-center">{{ group.name }}</h2></span>
                                                <span class="col-md-2 col-lg-2 col-sm-2 text-center" style="padding: 20px 15px 10px 15px;">
                                                        <a v-show="(group.isLeader || is_manager)" :href="'/groups/' + group.id" class="btn btn-style-3" style="padding: 4px 8px; font-size: 15px;" title="Manage Group"><i class="fa fa-gear"></i></a>
                                                </span>
                                            </span>
                                            <!-- <h2 class="text-center">{{ group.name }}</h2>
                                            <button v-show="group.can_manage"><span class="fa fa-edit"></span></button> -->

                                            <div class="content">
                                                <ul class="nav nav-tabs" role="tablist">
                                                    <li role="presentation" class="active grp-li">
                                                        <a :href="'#grp-desc-' + group.id" role="tab" data-toggle="tab">Description</a>
                                                    </li>
                                                    <li role="presentation" class="grp-li">
                                                        <a :href="'#grp-members-' + group.id" role="tab" data-toggle="tab">Members</a>
                                                    </li>
                                                    <li role="presentation" class="grp-li">
                                                        <a :href="'#grp-activities-' + group.id" role="tab" data-toggle="tab">Activities</a>
                                                    </li>
                                                </ul>

                                                <div class="tab-content">

                                                    <div role="tabpanel" class="tab-pane active" :id="'grp-desc-' + group.id">
                                                        <p v-if="group.about">{{ group.about }}</p>
                                                        <p v-else><i><small>Groups has no description.</small></i></p>
                                                    </div>

                                                    <div role="tabpanel" class="tab-pane" :id="'grp-members-' + group.id">
                                                        <div class="row" style="padding-bottom: 30px;">
                                                            <h5><strong>Leaders</strong></h5>
                                                            <template v-if="group.leaders.length > 0">
                                                                <div v-for="leader in group.leaders" class="col-md-6 mini-container">
                                                                    <a :href="'/profile/' + leader.id">
                                                                        <div>
                                                                            <img v-if="leader.image" class="img-circle" width="30px" height="30px" :src="user_images_folder+leader.image">
                                                                            <img v-else :src="'../../../static/images/pub-default-img.jpg'" width="30px" height="30px" class="img-circle">
                                                                            <span>{{ leader.firstname }} {{leader.lastname}}</span>
                                                                        </div>
                                                                    </a>
                                                                </div>
                                                            </template>
                                                            <template v-else>
                                                                <div style="padding-left: 10px;">
                                                                    <i><small>This group has no leaders.</small></i>
                                                                </div>
                                                            </template>
                                                        </div>
                                                        <div class="row" style="padding-bottom: 30px;">
                                                            <h5><strong>Members</strong></h5>
                                                            <template v-if="group.members.length > 0">
                                                                <div v-for="member in group.members" class="col-md-6 mini-container">
                                                                    <a :href="'/profile/' + member.id">
                                                                        <div>
                                                                            <img v-if="member.image" class="img-circle" width="30px" height="30px" :src="user_images_folder+member.image">
                                                                            <img v-else :src="'../../../static/images/pub-default-img.jpg'" width="30px" height="30px" class="img-circle">
                                                                            <span>{{ member.firstname }} {{member.lastname}}</span>
                                                                        </div>
                                                                    </a>
                                                                </div>
                                                            </template>
                                                            <template v-else>
                                                                <div style="padding-left: 10px;">
                                                                    <i><small>This group has no members.</small></i>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </div>

                                                    <div role="tabpanel" class="tab-pane" :id="'grp-activities-' + group.id">
                                                        <template v-if="group.activities.length > 0">
    
                                                            <div v-for="activity in group.activities">

                                                                <!-- ACTIVITY CARD ( v-on:click="openActivityModal(activity.id)"  ) -->
                                                                <div class="col-md-3 col-lg-4 col-sm-6 card-container" data-toggle="modal" :data-target="'#group-activity-' + activity.id">
                                                                    <div style="height: 160px; border-radius: 5px; border: 1px solid #d0d0d0;">
                                                                        <div style="height: 70%; overflow: hidden;">
                                                                            <template v-if="today > activity.end_date">
                                                                                <img :src="activity_card_images_folder + activity.image" class="img-responsive" style="-webkit-filter: grayscale(100%); filter: grayscale(100%); min-height: 100%; max-width: 100%; border-radius: 5px 5px 0 0;"/>
                                                                                <span style="color: green; font-size: 35px; position: absolute; top: 5px; right: 15px;">
                                                                                        <i class="fa fa-check-circle-o" title="ACTIVITY DONE"></i>
                                                                                </span>
                                                                            </template>
                                                                            <template v-else>
                                                                                <img :src="activity_card_images_folder + activity.image" class="img-responsive" style="min-height: 100%; max-width: 100%; border-radius: 5px 5px 0 0;"/>
                                                                            </template>
                                                                        </div>
                                                                        <div style="height: 30%; padding: 7px;">
                                                                            <h5 class="text-center title">{{ activity.title }}</h5>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- END OF ACTIVITY CARD -->

                                                            </div> <!-- end of activity listing -->
                                                            
                                                        </template>
                                                        <template v-else>
                                                            <div>
                                                                <p><i><small>Group has no activities.</small></i></p>
                                                            </div>
                                                        </template>
                                                    </div>

                                                </div> <!-- end of tab content -->

                                            </div>

                                        </div>

                                        <!-- FOOTER -->
                                        <div class="modal-footer">
                                            <template v-if="group.membership_status == 'accepted'">
                                                <button type="button" class="btn btn-danger grp-btn" value="leave" v-on:click="toggleGroupMembership(group)">LEAVE GROUP</button>
                                            </template>
                                            <template v-else-if="group.membership_status == 'pending'">
                                                <button type="button" class="btn btn-warning grp-btn" value="cancel" v-on:click="toggleGroupMembership(group)">CANCEL JOIN REQUEST</button>
                                            </template>
                                            <template v-else>
                                                <button type="button" class="btn btn-style-1 grp-btn" value="join" v-on:click="toggleGroupMembership(group)">JOIN GROUP</button>
                                            </template>
                                        </div> <!-- END OF FOOTER -->

                                    </div>
                                </div>
                            </div> <!-- END OF GROUP MODAL -->
                            
                        </div>
                        <div class="col-md-12 no-padding text-center show-more-box">
                        	<br/>
                            <button v-show="hasNext" class="btn btn-style-3" v-on:click="loadPerks">Show More</button>
                        </div>
                    </template>

	                <template v-else>
	                	<div class="col-md-12 no-content-box text-center">
                        	<h2><small>NO PERKS FOR TODAY</small></h2>
                    	</div>
	                </template>

				</div>
				{% endraw %}

			</div>
		</div>

	</div>

{% endblock content %}

{% block scripts %}
	<script>
		var vm = new Vue({
			el: "#perks_app",
			data: {
				perks: [],
				page: 1,
				hasNext: false,
				is_manager: false
			},
			methods: {
				loadPerks: function() {
					$.ajax({
						url: '../../api/v1.0/perks' + "?page=" + this.page,
						type: 'GET'
					}).done(data => {
						console.log(data);
						this.perks.push.apply(this.perks, data.perks);
						this.hasNext = data.has_next;
						this.page++;
					});
				}
			}
		});
		$(document).ready(function() {
			vm.loadPerks();
			vm.is_manager = "{{ is_manager }}" == "True" ? true : false;
		})
	</script>
{% endblock scripts %}