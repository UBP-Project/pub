{% extends "./layout/client_base.html" %}

{% block title %} {{ user['firstname'] }} {{ user['lastname'] }} Points {% endblock title %}

{% block content %}
    <div class="row">
        <div class="col-md-3 profile-info">
            {% if user.image %}
                <img src="{{ url_for('static', filename='uploads/profile_pictures/' + user.image) }}"
                    width="200px" 
                    height="200x" />
            {% else %}
                <img src="{{ url_for('static', filename='images/pub-default-img.jpg') }}"
                    width="200px" 
                    height="200x"/>
            {% endif %}
            <a href="{{ url_for('client.view_profile', id=user.id)}}">
                <h3>{{ user['firstname'] }} {{ user['lastname'] }}</h3>
            </a>
            <p>{{ user['position'] }} <br /> {{ user['department'] }}</p>
        </div>

        <div class="col-md-12 text-right" style="background-color: white; padding: 0px;">

            <!-- Check if user has set cover photo
            <img src="{{ url_for('static', filename='images/building.png') }}"
                style="width: 100%; height: 250px; z-index: 1;"/> -->

            <!-- hold the trianlify cover photo -->
            <div id="trianglify-cover" class="col-md-12 text-right" style="height: 250px; background-color: white; padding: 0px;">
            </div>

            <div id="profile-btns" style="padding: 0px 20px;">

                {% if user.total_points() > 0 %}
                    <a href="{{ url_for('client.points', id=user.id) }}" class="btn btn-xs following-count">
                        <h6>Points</h6>
                        <h4>{{ user.total_points() }}</h4>
                    </a>
                {% else %}
                    <div class="btn btn-xs points">
                        <h6>Points</h6>
                        <h4>{{ user.total_points() }}</h4>
                    </div>
                {% endif %}

                {% if following_count > 0 %}
                    <a href="{{ url_for('client.following', id=user.id) }}" class="btn btn-xs" style="padding: 0px 20px;">
                        <h6>Following</h6>
                        <h4>{{ following_count }}</h4>
                    </a>
                {% else %}
                    <div class="btn btn-xs" style="padding: 0px 20px;">
                        <h6>Following</h6>
                        <h4>{{ following_count }}</h4>
                    </div>
                {% endif %}

                {% if followers_count > 0 %}
                    <a href="{{ url_for('client.followers', id=user.id) }}" class="btn btn-xs" style="margin-right: 50px">
                        <h6>Followers</h6>
                        <h4>{{ followers_count }}</h4>
                    </a>
                {% else %}
                    <div class="btn btn-xs" style="margin-right: 50px">
                        <h6>Followers</h6>
                        <h4>{{ followers_count }}</h4>
                    </div>
                {% endif %}

                {% if current_user['id'] == user['id'] %}
                    <a href="{{ url_for('client.edit_profile', id=user.id) }}" id="btn-edit-profile" class="btn btn-style-3" style="width: 100px">Edit Profile</a>
                {% endif %}


                {% if current_user['id'] != user['id'] and is_following != True %}
                    <a id="btn-follow" class="btn btn-style-2" style="width: 100px">Follow</a>
                {% endif %}

                {% if current_user['id'] != user['id'] and is_following == True %}
                    <a id="btn-unfollow" class="btn btn-style-1" style="width: 100px">Following</a>
                {% endif %}
            </div>
        </div>


        <div class="row">
            {% raw %}
            <div id="points" class="col-md-offset-4 col-md-8" style="padding: 20px 0px;">
                <div class="row">

                    <div v-for="point in points" class="col-md-6" style="padding: 0px;">
                        <div style="background-color: white; padding: 10px; margin: 5px;">

                            <h4 style="color: #fd8103;" class="title"><strong>{{ point.event }}</strong></h4>
                            <h5>Earned Points: {{ point.value }}</h5>
                            <h5><small>{{ point.timestamp }}</small></h5>
                            
                        </div>
                    </div>

                </div>
            </div>
            {% endraw %}
        </div>

    </div>

{% endblock content %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/0.4.0/trianglify.min.js"></script>
    <script>

        var pattern = Trianglify({
            width: $("#trianglify-cover").width(),
            height: $("#trianglify-cover").height(),
            seed: "{{ user['id'] }}"
        });
        $("#trianglify-cover").append(pattern.svg());

        /*$.ajax({
            url: '/api/v1.0/mypoints',
            type: 'GET'
        }).done(function(data) {
            //console.log(data);
            var points = data.points_history;
            var total = data.total_points;
            //console.log(points);

        }).fail(function() {
            console.log("error");
        });*/

        var vm = new Vue({
            el: '#points',
            data: {
                points: []
            },
            methods: {
                loadPointHistory: function() {
                    $.ajax({
                        url: "{{ url_for('api.mypoints') }}",
                        type: 'GET'
                    }).done(data => {
                        this.points.push.apply(this.points, data.points_history);
                        console.log(this.points);
                    });
                }
            }
        });

        $(document).ready(function() {
            vm.loadPointHistory();
        });


    </script>
{% endblock scripts %}